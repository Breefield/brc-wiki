{% load static from staticfiles %}
{% load compress %}
{% load i18n %}
{% load cache %}
{% load hosts %}
{% load phased_tags %}
{% load django_xsession %}
{% load canonical_urls %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />

  <!-- Force true viewport size, so mobile browsers won't try to be clever -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame 
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <title>{% block title %}{% if region %}{{ region.full_name }} - {% endif %}LocalWiki{% endblock %}</title>

  {% block search_robots %}
  <meta name="robots" content="index,follow">
  {% endblock %}
  {% block canonical_url %}
    {% render_canonical_url %}
  {% endblock %}

  {% block media %}
    <!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    
    <script type="text/javascript">
        {% if region %}
            var region_id = {{ region.id }};
            var region_slug = '{{ region.slug }}';
            var region_name = '{{ region.full_name }}';
            var home_hostname = '{{ MAIN_HOSTNAME }}';
            {% if is_region_admin %}
            var region_is_admin = true;
            {% else %}
            var region_is_admin = false;
            {% endif %}
        {% else %}
            var region_id = null;
        {% endif %}
    </script>

    {# All of the commonly-used JS goes here #}
    {% compress js %}
    <script src="{{ STATIC_URL }}jsi18n/{{ LANGUAGE_CODE }}/djangojs.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery/jquery-1.7.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}theme/js/jquery/jquery-ui/jquery-ui.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/enquire.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}theme/js/handlebars.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}theme/js/typeahead.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}theme/js/base.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/srcset.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}tagedit/js/jquery.tagedit.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}tagedit/js/jquery.autoGrowInput.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}openlayers/OpenLayers.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}olwidget/js/olwidget.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}olwidget/js/sapling_utils.js"></script>
    <script src="{{ STATIC_URL }}js/coverphoto.js"></script>
    {% endcompress %}

    {# All of the commonly-used CSS goes here #}
    {% compress css %}
    <link rel="stylesheet" href="{{ STATIC_URL }}theme/css/font_face.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}theme/css/reset.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}theme/css/site.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/pages.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}tagedit/css/jquery.tagedit.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}olwidget/css/sapling.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/frontpage.css"/>
    {% endcompress %}

    {% include "site/extra_media.html" %}

    {% xsession_loader %}
  {% endblock %}

  {% block analytics %}
  {% cache 0 google_analytics %}
  {% if config.GOOGLE_ANALYTICS_ID %}
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '{{ config.GOOGLE_ANALYTICS_ID }}']);
    {% if config.GOOGLE_ANALYTICS_SUBDOMAINS %}
      _gaq.push(['_setDomainName', '{{ config.GOOGLE_ANALYTICS_SUBDOMAINS }}']);
      {% if config.GOOGLE_ANALYTICS_MULTIPLE_TOPLEVEL_DOMAINS %}
        _gaq.push(['_setAllowLinker', true]);
      {% endif %}
    {% endif %}
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  {% endif %}
  {% endcache %}
  {% endblock %}

  {% block head_extra %}{% endblock %}
</head>

{% block body %}
<body>
  <div>

  {% if not region %}
  <div id="preview_banner">
  <p id="ask">{% blocktrans %}This is an <strong>insanely</strong> early preview of the <a href="http://localwiki.org/blog/2013/jul/25/big-news-future-localwiki/" target="_blank">new version of LocalWiki</a>.  We're making everything open as we build, but there's not much to see here yet.<br/>Feel free to share with your friends, but not too widely &mdash; we are a long way away from launching!{% endblocktrans %}</p>
  </div>
  {% endif %}

  {% block everything_wrapper %}

    <div id="header">
      <div id="common_header">
        <div id="common_title">{% include "site/common_title.html" %}</div>
        <div class="site_search search">{% include "site/search_form.html" %}</div>
        <div id="login_info">{% include "site/login_info.html" %}</div>
      </div>
      <div id="region_header"
        {% if not region %}class="not_in_region"{% else %}{% if region.regionsettings.logo %}class="with_logo"{% endif %}{% endif %}>
        {% if region %}<div id="region_title">{% include "site/region_title.html" %}</div>{% endif %}
          <div id="nav">
            <a href="#" id="pull"></a>
            <ul>
              {% include "site/nav.html" %}
            </ul>
          </div>
        {% if region %}
          {% include "site/add_page_area.html" %}
        {% endif %}
      </div>
      {% block header_bar_wrapper %}
      <div id="header_bar">
          {% block header_bar_inner %}
          <div class="inner">
            <div id="object_actions">{% block object_actions %}{% endblock %}</div>
            <h1 id="object_title">{% block header_title %}{% endblock %}</h1>
            {% block header_subtitle %}{% endblock %}
          </div>
          {% endblock %}
      </div>
      {% endblock %}
    </div>

    {% block main_wrapper %}
    <div id="main">
      {% block main %}
        <div id="main_header">
        {% block main_header %}
          {% block messages %}
            {% phased %}
            {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif%}>{{ message|safe }}</li>
                {% endfor %}
            </ul>
            {% endif %}
            {% endphased %}
          {% endblock %}

          {% block dialog %}{% endblock %}
        {% endblock %}
        </div>
      
        {% block content_wrapper %}
        <div id="content_wrapper">
          <div id="content">
          {% block content %}
            {% block content_header %}{% endblock %}
            {% block content_footer %}{% endblock %}
          {% endblock %}
          </div>
        </div>
        {% endblock %}
      {% endblock %}
    </div>
    {% endblock %}

    <div id="footer">
     {% block footer %}
     {% endblock %}
    </div>

    {% if region %}
      {% cache 3600 nearby_regions region %}
        {% if region.get_nearby_regions %}
        <div id="nearby_regions_bar">
          Nearby LocalWiki regions:
          {% for region in region.get_nearby_regions %}
              <a href="{% host_url 'frontpage' region=region.slug on hub %}">{{ region.full_name }}</a>
          {% endfor %}
        </div>
        {% endif %}
      {% endcache %}
    {% endif %}

    <div id="about">
      <p>
      {% blocktrans %}
      LocalWiki is a grassroots effort to collect, share and open the worldâ€™s local knowledge.  We are a 501(c)3 non-profit organization. <a href="http://localwiki.org/about/" target="_blank">Learn more</a>.</p>
      {% endblocktrans %} 
      </p>
    </div>

    <div id="attributions">
     {% block attributions %}
       {% trans GLOBAL_LICENSE_NOTE|safe %}
     {% endblock %}
    </div>

    <div id="powered_by">
      {% block powered_by %}
      <a href="http://localwiki.org/"><img src="{% static "theme/img/powered_by_localwiki.png" %}"/></a>
      {% endblock %}
    </div>

  {% endblock %}
  </div>
  
</body>
{% endblock %}
</html>

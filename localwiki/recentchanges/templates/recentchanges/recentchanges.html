{% extends "site/base.html" %}
{% load url from future %}
{% load i18n %}
{% load user_tags %}

{% block title %}{% trans "Recent Changes" %} - {{ block.super }}{% endblock %}

{% block head_extra %}<link rel="alternate" href="{% url 'recentchanges-feed' region=region.slug %}" type="application/rss+xml" title="{% trans "Recent Changes" %}"/>{% endblock %}

{% block header_title %}<a href="{% url 'recentchanges' region=region.slug %}">{% trans "Recent Changes" %}</a>{% endblock %}

{% block content %}
  <div id="recentchanges">
      {% for changes_on_item in changes %}

        {% for change in changes_on_item %}
          {% if forloop.first %}
            <h3><a href="{{ change.page.get_absolute_url }}">{{ change.page.name }}</a>
                {% blocktrans with version_date=change.version_info.date|timesince %}last modified {{ version_date }} ago{% endblocktrans %}</h3>
            <ul>
          {% endif %}

          {% if change.version_info.type not in ignore_types %}
            <li class="{{ change.classname }}">
              {# The change type label. E.g. 'changes', 'added', 'deleted', etc. #}
              {% if change.version_info.type in added_types %}
                  <span class="changelabel added"><span>{% trans "new"%}</span></span>
              {% else %}{% if change.version_info.type in deleted_types %}
                  <span class="changelabel deleted"><span>{% trans "deleted"%}</span></span>
              {% else %}
                  <a class="changelabel updated" href="{{ change.diff_url }}"><span>{% trans "changes" %}</span></a></span>
              {% endif %}{% endif %}

              {% if change.version_info.type in reverted_types %}
                  <span class="revert">{% blocktrans with version_date_timesince=change.version_info.reverted_to_version.version_info.date|timesince %}Reverted to version from {{ version_date_timesince }} ago{% endblocktrans %}</span>
              {% endif %}

              <span class="type"></span>

              {% if change.classname == 'redirect' %}
                  <span class="revert">{% blocktrans with url=change.destination.get_absolute_url destination=change.destination.name %}Redirected to <a href="{{ url }}">{{ destination }}</a>{% endblocktrans %}</span>
              {% endif %}

              {% if change.version_info.comment %}
                  <span class="comment">
                    {{ change.version_info.comment }}
                  </span>
              {% endif %}

              <span class="user">{% user_link change.version_info.user region=region ip=change.version_info.user_ip %}</span>
            </li>
          {% endif %}

          {% if forloop.last %}
            </ul>
          {% endif %}

        {% endfor %}

      {% endfor %}

    <div class="see_also">
      <p>{% url 'dashboard:main' region=region.slug as dashboard_main_url %}
        {% blocktrans %}For statistics about pages, maps, and more, check out the <a href="{{ dashboard_main_url }}">dashboard</a>{% endblocktrans %}
      </p>
    </div>

  </div>
{% endblock %}
